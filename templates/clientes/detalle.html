{% extends "base.html" %}

{% block title %}{{ cliente.nombre_completo }} - Detalle{% endblock %}

{% block content %}
<!-- Encabezado con Acciones -->
<div class="page-header">
    <div class="d-flex justify-content-between align-items-start flex-wrap">
        <div class="mb-3">
            <h2>
                <i class="bi bi-person-circle"></i> {{ cliente.nombre_completo }}
                {% if not cliente.activo %}
                    <span class="badge bg-secondary">Inactivo</span>
                {% endif %}
            </h2>
            <p class="text-muted mb-0">Informaci√≥n completa del estudiante</p>
        </div>
        <div class="btn-group mb-3" role="group">
            <a href="{{ url_for('pago_nuevo', cliente_id=cliente.id) }}" 
               class="btn btn-success">
                <i class="bi bi-credit-card"></i> Registrar Pago
            </a>
            <a href="{{ url_for('pagos_estudiante_pdf', cliente_id=cliente.id) }}" 
               class="btn btn-danger"
               target="_blank">
                <i class="bi bi-file-pdf"></i> Descargar PDF
            </a>
            <a href="{{ url_for('cliente_editar', id=cliente.id) }}" 
               class="btn btn-warning">
                <i class="bi bi-pencil"></i> Editar
            </a>
            <a href="{{ url_for('clientes') }}" 
               class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Volver
            </a>
        </div>
    </div>
</div>

<!-- ‚úÖ TARJETA DE INSCRIPCI√ìN CON SISTEMA DE TRACKING -->
{% if cliente.curso and cliente.curso.precio_inscripcion > 0 %}
<div class="card mb-4 shadow-lg" style="border: 3px solid {% if cliente.inscripcion_pagada %}#10b981{% else %}#f59e0b{% endif %}; border-radius: 15px; overflow: hidden;">
    <div class="card-header" style="background: {% if cliente.inscripcion_pagada %}linear-gradient(135deg, #10b981 0%, #059669 100%){% else %}linear-gradient(135deg, #f59e0b 0%, #d97706 100%){% endif %}; color: white; padding: 20px;">
        <div class="d-flex justify-content-between align-items-center">
            <h4 class="mb-0 fw-bold">
                <i class="bi bi-{% if cliente.inscripcion_pagada %}check-circle-fill{% else %}hourglass-split{% endif %}"></i> 
                Estado de Inscripci√≥n
            </h4>
            {% if cliente.inscripcion_pagada %}
                <span class="badge bg-white text-success" style="font-size: 14px; padding: 10px 15px;">
                    <i class="bi bi-check-circle-fill"></i> COMPLETADA
                </span>
            {% else %}
                <span class="badge bg-white text-warning" style="font-size: 14px; padding: 10px 15px;">
                    <i class="bi bi-hourglass-split"></i> PENDIENTE
                </span>
            {% endif %}
        </div>
    </div>
    <div class="card-body" style="padding: 30px;">
        <div class="row align-items-center">
            <!-- Icono de Estado -->
            <div class="col-md-3 text-center mb-3 mb-md-0">
                <div style="width: 140px; height: 140px; margin: 0 auto; border-radius: 50%; background: {% if cliente.inscripcion_pagada %}linear-gradient(135deg, #10b981 0%, #059669 100%){% else %}linear-gradient(135deg, #f59e0b 0%, #d97706 100%){% endif %}; display: flex; align-items: center; justify-content: center; color: white; font-size: 64px; box-shadow: 0 8px 20px rgba(0,0,0,0.15);">
                    <i class="bi bi-{% if cliente.inscripcion_pagada %}check-circle-fill{% else %}hourglass-split{% endif %}"></i>
                </div>
            </div>
            
            <!-- Informaci√≥n Detallada -->
            <div class="col-md-9">
                {% if cliente.inscripcion_pagada %}
                    <!-- INSCRIPCI√ìN COMPLETADA -->
                    <h3 class="text-success mb-3">
                        <i class="bi bi-check-circle-fill"></i> Inscripci√≥n Completada
                    </h3>
                    <p class="lead mb-3">
                        El estudiante ha pagado completamente su inscripci√≥n de 
                        <strong class="text-success">${{ "%.2f"|format(cliente.curso.precio_inscripcion) }}</strong>
                    </p>
                    <div class="progress mb-2" style="height: 30px; border-radius: 15px; background: #e5e7eb;">
                        <div class="progress-bar bg-success" 
                             role="progressbar" 
                             style="width: 100%; font-size: 16px; font-weight: bold; border-radius: 15px;"
                             aria-valuenow="100" 
                             aria-valuemin="0" 
                             aria-valuemax="100">
                            <i class="bi bi-check-circle-fill"></i> 100% Completado
                        </div>
                    </div>
                    <div class="d-flex justify-content-between">
                        <small class="text-success fw-bold">
                            <i class="bi bi-cash-coin"></i> Pagado: ${{ "%.2f"|format(cliente.abono_inscripcion) }}
                        </small>
                        <small class="text-muted">
                            <i class="bi bi-calendar-check"></i> Total: ${{ "%.2f"|format(cliente.curso.precio_inscripcion) }}
                        </small>
                    </div>
                {% else %}
                    <!-- INSCRIPCI√ìN PENDIENTE -->
                    <h3 class="text-warning mb-3">
                        <i class="bi bi-exclamation-triangle-fill"></i> Inscripci√≥n Pendiente
                    </h3>
                    <p class="lead mb-3">
                        Falta abonar 
                        <strong class="text-danger">${{ "%.2f"|format(cliente.inscripcion_pendiente) }}</strong> 
                        de ${{ "%.2f"|format(cliente.curso.precio_inscripcion) }}
                    </p>
                    <div class="progress mb-2" style="height: 30px; border-radius: 15px; background: #e5e7eb;">
                        {% set porcentaje = ((cliente.abono_inscripcion / cliente.curso.precio_inscripcion) * 100) if cliente.curso.precio_inscripcion > 0 else 0 %}
                        <div class="progress-bar progress-bar-striped progress-bar-animated bg-warning" 
                             role="progressbar" 
                             style="width: {{ "%.0f"|format(porcentaje) }}%; font-size: 16px; font-weight: bold; border-radius: 15px;"
                             aria-valuenow="{{ porcentaje }}" 
                             aria-valuemin="0" 
                             aria-valuemax="100">
                            {{ "%.0f"|format(porcentaje) }}% - ${{ "%.2f"|format(cliente.abono_inscripcion) }} pagado
                        </div>
                    </div>
                    <div class="d-flex justify-content-between">
                        <small class="text-muted">
                            <i class="bi bi-cash-coin"></i> Abonado: ${{ "%.2f"|format(cliente.abono_inscripcion) }}
                        </small>
                        <small class="text-danger fw-bold">
                            <i class="bi bi-exclamation-circle"></i> Pendiente: ${{ "%.2f"|format(cliente.inscripcion_pendiente) }}
                        </small>
                    </div>
                    
                    <!-- Bot√≥n de Pago R√°pido -->
                    <div class="mt-3">
                        <a href="{{ url_for('pago_nuevo', cliente_id=cliente.id) }}" 
                           class="btn btn-warning btn-lg w-100">
                            <i class="bi bi-credit-card-fill"></i> 
                            Abonar a Inscripci√≥n (${{ "%.2f"|format(cliente.inscripcion_pendiente) }})
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endif %}
<!-- ‚úÖ ALERTA: PAGO √öNICO PENDIENTE -->
{% if cliente.modalidad_pago == 'unico' and cliente.mensualidades_canceladas == 0 and cliente.curso and not cliente.curso.es_indefinido %}
<div class="alert alert-warning shadow-sm" style="border-left: 5px solid #ffc107; border-radius: 10px;">
    <div class="d-flex align-items-center">
        <i class="bi bi-exclamation-triangle-fill me-3" style="font-size: 48px;"></i>
        <div class="flex-grow-1">
            <h5 class="alert-heading mb-1 fw-bold">‚è≥ Pago √önico Pendiente</h5>
            <p class="mb-2">
                El estudiante eligi√≥ pagar el curso completo pero a√∫n no ha realizado el pago.
            </p>
            <hr>
            <div class="row">
                <div class="col-md-6 mb-2">
                    <strong>Monto total:</strong><br>
                    <span class="fs-4 text-success">
                        ${{ "%.2f"|format(cliente.curso.precio_inscripcion + (cliente.curso.precio_mensual * cliente.curso.duracion_meses)) }}
                    </span>
                </div>
                <div class="col-md-6 mb-2">
                    <strong>Incluye:</strong><br>
                    <small>
                        ‚Ä¢ Inscripci√≥n: ${{ "%.2f"|format(cliente.curso.precio_inscripcion) }}<br>
                        ‚Ä¢ {{ cliente.curso.duracion_meses }} mensualidades: ${{ "%.2f"|format(cliente.curso.precio_mensual * cliente.curso.duracion_meses) }}
                    </small>
                </div>
            </div>
        </div>
        <div>
            <a href="{{ url_for('pago_nuevo', cliente_id=cliente.id) }}" 
               class="btn btn-warning btn-lg">
                <i class="bi bi-credit-card-fill"></i> Registrar Pago Completo
            </a>
        </div>
    </div>
</div>
{% endif %}
<!-- Alerta de Vencimiento -->
{% if cliente.plan_vencido %}
<div class="alert alert-danger shadow-sm" style="border-left: 5px solid #dc3545; border-radius: 10px;">
    <div class="d-flex align-items-center">
        <i class="bi bi-exclamation-triangle-fill me-3" style="font-size: 48px;"></i>
        <div>
            <h5 class="alert-heading mb-1 fw-bold">‚ö†Ô∏è Mensualidad Vencida</h5>
            <p class="mb-0">Este estudiante necesita renovar su mensualidad urgentemente.</p>
        </div>
    </div>
</div>
{% elif cliente.dias_restantes is not none and cliente.dias_restantes <= 7 and cliente.ha_iniciado_clases %}
<div class="alert alert-warning shadow-sm" style="border-left: 5px solid #ffc107; border-radius: 10px;">
    <div class="d-flex align-items-center">
        <i class="bi bi-clock-history me-3" style="font-size: 48px;"></i>
        <div>
            <h5 class="alert-heading mb-1 fw-bold">‚è∞ Pr√≥ximo a Vencer</h5>
            <p class="mb-0">
                Quedan <strong>{{ cliente.dias_restantes }} d√≠a{{ 's' if cliente.dias_restantes != 1 else '' }}</strong> 
                hasta el vencimiento ({{ cliente.fecha_fin.strftime('%d/%m/%Y') }})
            </p>
        </div>
    </div>
</div>
{% endif %}

<div class="row">
    <!-- COLUMNA IZQUIERDA: Informaci√≥n Personal -->
    <div class="col-lg-4 mb-4">
        <!-- Datos Personales -->
        <div class="card mb-3 shadow-sm" style="border-left: 5px solid #667eea; border-radius: 10px;">
            <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 10px 10px 0 0;">
                <h5 class="mb-0">
                    <i class="bi bi-person-vcard"></i> Datos Personales
                </h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <h6 class="text-muted mb-1">
                        <i class="bi bi-person-fill"></i> Nombre Completo
                    </h6>
                    <p class="fw-bold mb-0 fs-5">{{ cliente.nombre_completo }}</p>
                </div>
                
                <div class="mb-3">
                    <h6 class="text-muted mb-1">
                        <i class="bi bi-envelope-fill"></i> Email
                    </h6>
                    <p class="mb-0">
                        <a href="mailto:{{ cliente.email }}" class="text-decoration-none">
                            {{ cliente.email }}
                        </a>
                    </p>
                </div>
                
                <div class="mb-3">
                    <h6 class="text-muted mb-1">
                        <i class="bi bi-card-text"></i> C√©dula/DNI
                    </h6>
                    <p class="mb-0">
                        {% if cliente.cedula %}
                            <span class="badge bg-secondary" style="font-size: 13px; font-family: monospace;">
                                {{ cliente.cedula }}
                            </span>
                        {% else %}
                            <span class="text-muted">No registrada</span>
                        {% endif %}
                    </p>
                </div>

                {% if cliente.telefono %}
                <div class="mb-3">
                    <h6 class="text-muted mb-1">
                        <i class="bi bi-phone-fill"></i> Tel√©fono
                    </h6>
                    <p class="mb-0">
                        <a href="tel:{{ cliente.telefono }}" class="text-decoration-none">
                            <i class="bi bi-telephone"></i> {{ cliente.telefono }}
                        </a>
                    </p>
                </div>
                {% endif %}

                {% if cliente.direccion %}
                <div class="mb-3">
                    <h6 class="text-muted mb-1">
                        <i class="bi bi-geo-alt-fill"></i> Direcci√≥n
                    </h6>
                    <p class="mb-0">{{ cliente.direccion }}</p>
                </div>
                {% endif %}

                <div class="mb-0">
                    <h6 class="text-muted mb-1">
                        <i class="bi bi-toggle-on"></i> Estado
                    </h6>
                    <p class="mb-0">
                        {% if cliente.activo %}
                            <span class="badge bg-success" style="font-size: 14px; padding: 8px 12px;">
                                <i class="bi bi-check-circle-fill"></i> Activo
                            </span>
                        {% else %}
                            <span class="badge bg-secondary" style="font-size: 14px; padding: 8px 12px;">
                                <i class="bi bi-x-circle-fill"></i> Inactivo
                            </span>
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>

        <!-- Datos de Inscripci√≥n Acad√©mica -->
        <div class="card shadow-sm" style="border-left: 5px solid #28a745; border-radius: 10px;">
            <div class="card-header" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; border-radius: 10px 10px 0 0;">
                <h5 class="mb-0">
                    <i class="bi bi-calendar-check"></i> Informaci√≥n Acad√©mica
                </h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <h6 class="text-muted mb-1">
                        <i class="bi bi-calendar-event"></i> Fecha de Registro
                    </h6>
                    <p class="mb-0 fw-bold">
                        {{ cliente.fecha_registro.strftime('%d/%m/%Y') if cliente.fecha_registro else 'N/A' }}
                    </p>
                </div>

                <div class="mb-3">
                    <h6 class="text-muted mb-1">
                        <i class="bi bi-calendar-plus"></i> Inicio de Clases
                    </h6>
                    <p class="mb-0 fw-bold">
                        {{ cliente.fecha_inicio_clases.strftime('%d/%m/%Y') if cliente.fecha_inicio_clases else 'N/A' }}
                    </p>
                </div>

                <div class="mb-3">
                    <h6 class="text-muted mb-1">
                        <i class="bi bi-check2-circle"></i> Mensualidades Pagadas
                    </h6>
                    <p class="mb-0">
                        <span class="badge bg-primary" style="font-size: 16px; padding: 10px 15px;">
                            {{ cliente.mensualidades_canceladas }} mes{{ 'es' if cliente.mensualidades_canceladas != 1 else '' }}
                        </span>
                    </p>
                </div>

                {% if cliente.observaciones_inscripcion %}
                <div class="mb-0">
                    <h6 class="text-muted mb-1">
                        <i class="bi bi-chat-left-text"></i> Observaciones
                    </h6>
                    <div class="card bg-light">
                        <div class="card-body">
                            <p class="small mb-0" style="white-space: pre-wrap;">{{ cliente.observaciones_inscripcion }}</p>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- COLUMNA DERECHA: Curso y Pagos -->
    <div class="col-lg-8 mb-4">
        <!-- Curso Actual -->
        <div class="card mb-4 shadow-lg" style="border: 3px solid #38ef7d; border-radius: 15px;">
            <div class="card-header" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 20px; border-radius: 15px 15px 0 0;">
                <h4 class="mb-0 fw-bold">
                    <i class="bi bi-book-fill"></i> Curso Inscrito
                </h4>
            </div>
            <div class="card-body" style="padding: 30px;">
                {% if cliente.curso %}
                <div class="row align-items-center mb-4">
                    <div class="col-md-6">
                        <h2 class="text-primary mb-2 fw-bold">{{ cliente.curso.nombre }}</h2>
                        {% if cliente.curso.descripcion %}
                        <p class="text-muted mb-0">{{ cliente.curso.descripcion }}</p>
                        {% endif %}
                    </div>
                    <div class="col-md-3 text-center">
                        <h6 class="text-muted mb-1">Mensualidad</h6>
                        <h1 class="text-success mb-0 fw-bold">
                            ${{ "%.2f"|format(cliente.curso.precio_mensual) }}
                        </h1>
                        <small class="text-muted">/mes</small>
                    </div>
                    <div class="col-md-3 text-center">
                        <h6 class="text-muted mb-1">Duraci√≥n</h6>
                        {% if cliente.curso.es_indefinido %}
                        <h1 class="text-info mb-0">
                            <i class="bi bi-infinity"></i>
                        </h1>
                        <small class="text-muted">Indefinido</small>
                        {% else %}
                        <h1 class="text-primary mb-0 fw-bold">
                            {{ cliente.curso.duracion_meses }}
                        </h1>
                        <small class="text-muted">{{ 'meses' if cliente.curso.duracion_meses != 1 else 'mes' }}</small>
                        {% endif %}
                    </div>
                
                <!-- Informaci√≥n de Vencimiento -->
                {% if cliente.fecha_fin %}
                <div class="card" style="background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); border: 2px solid #d1d5db; border-radius: 10px;">
                    <div class="card-body" style="padding: 25px;">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <h6 class="text-muted mb-2">
                                    <i class="bi bi-calendar-x"></i> Pr√≥ximo Vencimiento
                                </h6>
                                <h3 class="mb-0 fw-bold text-dark">
                                    {{ cliente.fecha_fin.strftime('%d/%m/%Y') }}
                                </h3>
                            </div>
                            <div class="col-md-6 text-end">
                                {% if cliente.dias_restantes is not none %}
                                    {% if cliente.estado_pago == 'pendiente-inicio' %}
                                        <span class="badge" style="font-size: 18px; padding: 15px 25px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border: none;">
                                            <i class="bi bi-calendar-plus"></i> Inicia en {{ cliente.dias_para_inicio }} d√≠a{{ 's' if cliente.dias_para_inicio != 1 else '' }}
                                        </span>
                                        <div class="mt-2">
                                            <small class="text-muted">
                                                <i class="bi bi-info-circle"></i> Cobertura: <strong>{{ cliente.dias_restantes }}</strong> d√≠a{{ 's' if cliente.dias_restantes != 1 else '' }}
                                            </small>
                                        </div>
                                    {% elif cliente.dias_restantes > 7 %}
                                        <span class="badge bg-success" style="font-size: 20px; padding: 15px 25px;">
                                            <i class="bi bi-check-circle-fill"></i> {{ cliente.dias_restantes }} d√≠as
                                        </span>
                                    {% elif cliente.dias_restantes > 3 %}
                                        <span class="badge bg-warning text-dark" style="font-size: 20px; padding: 15px 25px;">
                                            <i class="bi bi-clock-fill"></i> {{ cliente.dias_restantes }} d√≠as
                                        </span>
                                    {% elif cliente.dias_restantes > 0 %}
                                        <span class="badge bg-danger" style="font-size: 20px; padding: 15px 25px;">
                                            <i class="bi bi-exclamation-triangle-fill"></i> {{ cliente.dias_restantes }} d√≠as
                                        </span>
                                    {% else %}
                                        <span class="badge bg-dark" style="font-size: 20px; padding: 15px 25px;">
                                            <i class="bi bi-x-circle-fill"></i> VENCIDO
                                        </span>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                {% else %}
                <div class="text-center py-5">
                    <i class="bi bi-exclamation-circle" style="font-size: 80px; color: #ccc;"></i>
                    <h4 class="mt-3 text-muted">No tiene curso asignado</h4>
                    <p class="text-muted">Asigna un curso para comenzar</p>
                    <a href="{{ url_for('cliente_editar', id=cliente.id) }}" class="btn btn-primary btn-lg mt-3">
                        <i class="bi bi-book-fill"></i> Asignar Curso
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Estado de Cuenta -->
        <div class="card mb-4 shadow-sm" style="border-radius: 10px;">
            <div class="card-header bg-white border-bottom">
                <h5 class="mb-0 fw-bold">
                    <i class="bi bi-graph-up-arrow"></i> Estado de Cuenta
                </h5>
            </div>
            <div class="card-body" style="padding: 25px;">
                <div class="row text-center g-3">
                    
                    <!-- TARJETA 1: ESTADO ACTUAL -->
<div class="col-md-4 mb-3">
    {% set estado_info = {
        'sin-cobertura': {
            'color': '#667eea 0%, #764ba2 100%',
            'icono': 'exclamation-circle-fill',
            'titulo': 'Sin Cobertura',
            'descripcion': 'Sin pagos registrados'
        },
        'pendiente-inicio': {
            'color': '#4facfe 0%, #00f2fe 100%',
            'icono': 'calendar-plus',
            'titulo': 'Pendiente Inicio',
            'descripcion': 'Clases a√∫n no comienzan'
        },
        'vencido': {
            'color': '#fa709a 0%, #fee140 100%',
            'icono': 'x-circle-fill',
            'titulo': 'Vencido',
            'descripcion': 'Renovaci√≥n urgente'
        },
        'por-vencer': {
            'color': '#f093fb 0%, #f5576c 100%',
            'icono': 'clock-fill',
            'titulo': 'Pr√≥ximo a Vencer',
            'descripcion': '‚â§7 d√≠as restantes'
        },
        'al-dia': {
            'color': '#11998e 0%, #38ef7d 100%',
            'icono': 'check-circle-fill',
            'titulo': 'Al D√≠a',
            'descripcion': 'Pago vigente'
        }
    } %}
    
    {% set estado_actual = cliente.estado_pago %}
    {% set info = estado_info.get(estado_actual, estado_info['sin-cobertura']) %}
    
    <div class="card h-100 shadow-sm" style="background: linear-gradient(135deg, {{ info.color }}); color: white; border-radius: 15px; border: none;">
        <div class="card-body" style="padding: 25px;">
            <i class="bi bi-{{ info.icono }}" style="font-size: 56px; opacity: 0.95;"></i>
            <h6 class="mt-3 mb-1 fw-bold" style="opacity: 0.9;">Estado Actual</h6>
            <h3 class="mb-1 fw-bold">{{ info.titulo }}</h3>
            <small style="opacity: 0.85;">{{ info.descripcion }}</small>
            
            {% if estado_actual == 'pendiente-inicio' and cliente.dias_para_inicio is not none %}
                <div class="mt-3 pt-3" style="border-top: 1px solid rgba(255,255,255,0.3);">
                    <small class="fw-bold">
                        <i class="bi bi-calendar-event"></i> En {{ cliente.dias_para_inicio }} d√≠a{{ 's' if cliente.dias_para_inicio != 1 else '' }}
                    </small>
                </div>
            {% elif estado_actual == 'vencido' and cliente.dias_restantes is not none %}
                <div class="mt-3 pt-3" style="border-top: 1px solid rgba(255,255,255,0.3);">
                    <small class="fw-bold">
                        <i class="bi bi-exclamation-triangle"></i> Hace {{ abs(cliente.dias_restantes) }} d√≠a{{ 's' if abs(cliente.dias_restantes) != 1 else '' }}
                    </small>
                </div>
            {% elif estado_actual in ['por-vencer', 'al-dia'] and cliente.dias_restantes is not none %}
                <div class="mt-3 pt-3" style="border-top: 1px solid rgba(255,255,255,0.3);">
                    <small class="fw-bold">
                        <i class="bi bi-clock"></i> {{ cliente.dias_restantes }} d√≠a{{ 's' if cliente.dias_restantes != 1 else '' }}
                    </small>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- TARJETA 2: MENSUALIDADES PAGADAS -->
<div class="col-md-4 mb-3">
    <div class="card h-100 shadow-sm" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; border-radius: 15px; border: none;">
        <div class="card-body" style="padding: 25px;">
            <i class="bi bi-calendar-check" style="font-size: 56px; opacity: 0.95;"></i>
            <h6 class="mt-3 mb-1 fw-bold" style="opacity: 0.9;">Mensualidades</h6>
            <h2 class="mb-1 fw-bold">{{ cliente.mensualidades_canceladas }}</h2>
            
            <div class="mt-3 pt-3" style="border-top: 1px solid rgba(255,255,255,0.3);">
                <small style="opacity: 0.9;">
                    Meses pagados
                </small>
            </div>
            
            {% if cliente.carry_mensualidad > 0 %}
            <div class="mt-2">
                <small class="fw-bold">
                    üí∞ Cr√©dito: ${{ "%.2f"|format(cliente.carry_mensualidad) }}
                </small>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- TARJETA 3: TOTAL PAGADO -->
<div class="col-md-4 mb-3">
    <div class="card h-100 shadow-sm" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; border-radius: 15px; border: none;">
        <div class="card-body" style="padding: 25px;">
            <i class="bi bi-currency-dollar" style="font-size: 56px; opacity: 0.95;"></i>
            <h6 class="mt-3 mb-1 fw-bold" style="opacity: 0.9;">Total Pagado</h6>
            <h2 class="mb-1 fw-bold">${{ "%.2f"|format(cliente.total_pagado) }}</h2>
            
            <div class="mt-3 pt-3" style="border-top: 1px solid rgba(255,255,255,0.3);">
                <small style="opacity: 0.9;">
                    {% if pagos %}
                        {{ pagos|length }} pago{{ 's' if pagos|length != 1 else '' }}
                    {% else %}
                        Sin pagos
                    {% endif %}
                </small>
            </div>
            
            {% if cliente.inscripcion_pagada and cliente.curso %}
            <div class="mt-2">
                <small class="fw-bold">
                    ‚úÖ Inscripci√≥n completa
                </small>
            </div>
            {% endif %}
        </div>
    </div>
</div>
                
            <!-- BARRA DE PROGRESO (SOLO SI HAY INSCRIPCI√ìN) -->
{% if cliente.curso and cliente.curso.precio_inscripcion > 0 %}
<div class="mt-4">
    <div class="d-flex justify-content-between align-items-center mb-2">
        <h6 class="mb-0 fw-bold">
            <i class="bi bi-bar-chart-fill"></i> Progreso de Inscripci√≥n
        </h6>
        <span class="badge bg-info" style="font-size: 14px; padding: 8px 12px;">
            {{ "%.0f"|format(cliente.porcentaje_inscripcion) }}%
        </span>
    </div>
    <div class="progress" style="height: 30px; border-radius: 15px; background: #e5e7eb; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);">
        <div class="progress-bar {% if cliente.inscripcion_pagada %}bg-success{% else %}progress-bar-striped progress-bar-animated bg-warning{% endif %} fw-bold" 
             role="progressbar" 
             style="width: {{ "%.0f"|format(cliente.porcentaje_inscripcion) }}%; 
                    font-size: 15px;
                    border-radius: 15px;"
             aria-valuenow="{{ cliente.porcentaje_inscripcion }}" 
             aria-valuemin="0" 
             aria-valuemax="100">
            ${{ "%.2f"|format(cliente.abono_inscripcion) }} / ${{ "%.2f"|format(cliente.curso.precio_inscripcion) }}
        </div>
    </div>
    <div class="mt-2 text-center">
        {% if cliente.inscripcion_pagada %}
            <small class="text-success fw-bold">
                <i class="bi bi-check-circle-fill"></i> Inscripci√≥n completada
            </small>
        {% else %}
            <small class="text-warning fw-bold">
                <i class="bi bi-hourglass-split"></i> Pendiente: ${{ "%.2f"|format(cliente.inscripcion_pendiente) }}
            </small>
        {% endif %}
    </div>
</div>
{% endif %}
        <!-- Historial de Pagos -->
        <div class="card shadow-sm" style="border-radius: 10px;">
            <div class="card-header bg-white border-bottom d-flex justify-content-between align-items-center">
                <h5 class="mb-0 fw-bold">
                    <i class="bi bi-clock-history"></i> Historial de Pagos
                </h5>
                <a href="{{ url_for('pago_nuevo', cliente_id=cliente.id) }}" 
                   class="btn btn-success">
                    <i class="bi bi-plus-circle"></i> Nuevo Pago
                </a>
            </div>
            <div class="card-body p-0">
                {% if pagos %}
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th style="padding: 15px;">Fecha</th>
                                <th style="padding: 15px;">Monto</th>
                                <th style="padding: 15px;">M√©todo</th>
                                <th style="padding: 15px;">Referencia</th>
                                <th style="padding: 15px;">Periodo</th>
                                <th class="text-center" style="padding: 15px;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for pago in pagos %}
                            <tr>
                                <td style="padding: 15px;">
                                    <strong class="text-primary">{{ pago.fecha_pago.strftime('%d/%m/%Y') }}</strong><br>
                                    <small class="text-muted">
                                        <i class="bi bi-clock"></i> {{ pago.fecha_pago.strftime('%H:%M') }}
                                    </small>
                                </td>
                                <td style="padding: 15px;">
                                    <span class="badge bg-success fw-bold" style="font-size: 15px; padding: 10px 15px;">
                                        ${{ "%.2f"|format(pago.monto) }}
                                    </span>
                                </td>
                                <td style="padding: 15px;">
                                    {% if pago.metodo_pago %}
                                        <span class="badge bg-info" style="font-size: 13px; padding: 8px 12px;">
                                            {{ pago.metodo_pago }}
                                        </span>
                                    {% else %}
                                        <span class="badge bg-secondary">N/A</span>
                                    {% endif %}
                                </td>
                                <td style="padding: 15px;">
                                    {% if pago.referencia %}
                                        <small class="font-monospace bg-light p-2 rounded">
                                            {{ pago.referencia }}
                                        </small>
                                    {% else %}
                                        <small class="text-muted">-</small>
                                    {% endif %}
                                </td>
                                <td style="padding: 15px;">
                                    {% if pago.periodo %}
                                        <span class="badge bg-light text-dark border">
                                            <i class="bi bi-calendar3"></i> {{ pago.periodo }}
                                        </span>
                                    {% else %}
                                        <small class="text-muted">-</small>
                                    {% endif %}
                                </td>
                                <td class="text-center" style="padding: 15px;">
                                    <button type="button" 
                                            class="btn btn-sm btn-outline-danger" 
                                            onclick="confirmarEliminarPago({{ pago.id }}, {{ pago.monto }})"
                                            title="Eliminar pago"
                                            data-bs-toggle="tooltip">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot class="table-light">
                            <tr>
                                <td colspan="1" style="padding: 15px;">
                                    <strong class="fs-5">TOTAL</strong>
                                </td>
                                <td colspan="5" style="padding: 15px;">
                                    <strong class="text-success fs-4">
                                        ${{ "%.2f"|format(pagos|sum(attribute='monto')) }}
                                    </strong>
                                    <small class="text-muted ms-2">
                                        ({{ pagos|length }} pago{{ 's' if pagos|length != 1 else '' }})
                                    </small>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-5">
                    <i class="bi bi-inbox" style="font-size: 80px; color: #ccc;"></i>
                    <h4 class="mt-3 text-muted">Sin pagos registrados</h4>
                    <p class="text-muted">Los pagos aparecer√°n aqu√≠ una vez registrados</p>
                    <a href="{{ url_for('pago_nuevo', cliente_id=cliente.id) }}" class="btn btn-success btn-lg mt-3">
                        <i class="bi bi-plus-circle"></i> Registrar Primer Pago
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Inicializar tooltips de Bootstrap
    document.addEventListener('DOMContentLoaded', function() {
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    });

    // Confirmaci√≥n de eliminaci√≥n de pago
    function confirmarEliminarPago(pagoId, monto) {
        if (confirm(`¬øEst√°s seguro de eliminar este pago de ${monto.toFixed(2)}?\n\n‚ö†Ô∏è Esta acci√≥n recalcular√° autom√°ticamente la cobertura del estudiante.\n\n‚úì Los datos se actualizar√°n correctamente.\n\nEsta acci√≥n NO se puede deshacer.`)) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = `/pagos/${pagoId}/eliminar`;
            document.body.appendChild(form);
            form.submit();
        }
    }
</script>
{% endblock %}>${{ "%.2f"|format(cliente.saldo_pendiente) }}</h2>
                                
                                {% if cliente.saldo_pendiente > 0 %}
                                <div class="mt-3 pt-3" style="border-top: 1px solid rgba(255,255,255,0.3);">
                                    <small style="opacity: 0.9;">
                                        Total: ${{ "%.2f"|format(cliente.total_programa) }}<br>
                                        Pagado: ${{ "%.2f"|format(cliente.total_pagado) }}
                                    </small>
                                </div>
                                {% else %}
                                <div class="mt-3">
                                    <small class="fw-bold">
                                        <i class="bi bi-check-circle-fill"></i> Completado
                                    </small>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
